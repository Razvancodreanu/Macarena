<!doctype html>
<html lang="ro">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Macarena • Live Location</title>

    <!-- Leaflet -->
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            crossorigin=""
            defer></script>

    <!-- Supabase JS v2 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>

    <!-- CSS cu cache-bust -->
    <link rel="stylesheet" href="./style.css?v=5" />
</head>
<body>
    <header class="topbar">
        <div class="brand">Macarena • Live Location</div>
        <div class="room-inline">
            <input id="room" type="text" placeholder="Nume cameră (ex: familia)" />
            <button id="btnJoin">Join</button>
            <button id="btnLeave" class="ghost">Leave</button>
            <button id="btnCenter">Center me</button>
        </div>
    </header>

    <!-- Harta pe stânga -->
    <main id="map" aria-label="Hartă"></main>

    <!-- Panoul din dreapta / jos (mobil) -->
    <aside id="panel" aria-label="Panou">
        <!-- Profil -->
        <section class="card">
            <h3>Profil</h3>
            <div class="row">
                <img id="profilePhoto" class="avatar" alt="avatar" />
                <input id="profileName" type="text" placeholder="Nume și prenume" />
            </div>
            <div class="row">
                <label class="btn">
                    Încarcă poză
                    <input id="photoInput" type="file" accept="image/*" hidden />
                </label>
                <button id="saveProfileBtn" class="ghost">Salvează</button>
            </div>
        </section>

        <!-- Autentificare -->
        <section class="card">
            <h3>Autentificare</h3>
            <div class="stack">
                <button id="btnGoogle" class="btn-google">Sign in with Google</button>
                <div class="row">
                    <input id="magicEmail" type="email" placeholder="email pentru magic link" />
                    <button id="btnMagic">Trimite link</button>
                </div>
                <div class="row">
                    <input id="phoneInput" type="tel" placeholder="+40 7xx xxx xxx" />
                    <button id="btnSmsOtp">SMS OTP</button>
                </div>
                <div class="row">
                    <input id="otpInput" type="text" placeholder="Cod SMS" />
                    <button id="btnSmsConfirm">Confirmă</button>
                </div>
                <button id="btnSignOut" class="ghost">Sign out</button>
            </div>
            <div id="authStatus" class="note">Neautentificat</div>
        </section>

        <!-- Vizibilitate -->
        <section class="card">
            <h3>Vizibilitate</h3>
            <label class="inline"><input type="radio" name="vis" id="visGlobal" checked /> Global (toți)</label>
            <label class="inline"><input type="radio" name="vis" id="visPrivate" /> Cameră privată</label>
            <div class="row">
                <input id="inviteLink" type="text" placeholder="Link invitație cameră" readonly />
                <button id="btnCopy" class="ghost">Copy</button>
            </div>
        </section>

        <!-- Share location -->
        <section class="card">
            <h3>Share location</h3>
            <div class="row">
                <button id="btnStart" class="ok">Start sharing</button>
                <button id="btnStop" class="danger">Stop</button>
            </div>
            <small class="note">Permite locația în browser. Trimite la ~5 sec când se schimbă.</small>
        </section>

        <!-- Alerte -->
        <section class="card">
            <h3>Alerte</h3>
            <div class="row">
                <button id="btnSOS" class="sos" title="Scurt: alege tipul • Lung: 3 sec → SOS">SOS</button>
                <span id="sosCounter" class="counter hidden">3</span>
                <button id="btnCheckin">Check-in</button>
            </div>
        </section>

        <!-- Live / Membri -->
        <section class="card">
            <h3>Live • Membri</h3>
            <div id="members" class="list note">-</div>
        </section>

        <!-- Traseu -->
        <section class="card">
            <h3>Traseu (24h)</h3>
            <div class="row">
                <button id="btnTrailLoad" class="ghost">Încarcă</button>
                <button id="btnTrailClear" class="ghost">Curăță</button>
            </div>
        </section>

        <footer class="mini">
            <small>schema: <b>macarena</b> • tabele: <i>profiles, locations, locations_history, alerts</i></small>
        </footer>
    </aside>

    <!-- Sunet alertă -->
    <audio id="alertSound" preload="auto">
        <source src="https://cdn.jsdelivr.net/gh/itsrealfarhan/sfx/siren-short.mp3" type="audio/mpeg" />
    </audio>

    <!-- JS cu cache-bust -->
    <script src="./app.js?v=5" defer></script>
</body>
</html>
